var k=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var _=(r,t,e)=>t in r?k(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,B=(r,t)=>{for(var e in t||(t={}))$.call(t,e)&&_(r,e,t[e]);if(O)for(var e of O(t))j.call(t,e)&&_(r,e,t[e]);return r},D=(r,t)=>q(r,z(t));var i=(r,t,e)=>(_(r,typeof t!="symbol"?t+"":t,e),e);const U=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};U();class d{constructor(t){i(this,"top");i(this,"left");i(this,"width");i(this,"height");i(this,"color");this.top=t.top,this.left=t.left,this.width=t.width,this.height=t.height,this.color=t.color||"#000"}get right(){return this.left+this.width}get bottom(){return this.top+this.height}render(t){t.fillStyle=this.color,t.fillRect(this.left,this.top,this.width,this.height)}isOverlay(t){const e=[this.left,this.right],n=[this.top,this.bottom];return this.getCoordination(t).some(([o,h])=>this.isInRange(o,e)&&this.isInRange(h,n))||t.isContain(this)}isContain(t){const e=[this.left,this.right],n=[this.top,this.bottom];return this.getCoordination(t).every(([o,h])=>this.isInRange(o,e)&&this.isInRange(h,n))}isInRange(t,e){return t>=e[0]&&t<=e[1]}getCoordination({top:t,left:e,right:n,bottom:s}){return[[e,t],[n,t],[n,s],[e,s]]}}class H extends d{constructor(t){super(t)}isCollidedWith(t){return this.isOverlay(t)}}class v{add(t){return this.create(this.value+t.value)}substract(t){return this.create(this.value-t.value)}multiple(t){return this.create(this.value*t)}}const K=Symbol();var rt;const R=class extends v{constructor(t){super();i(this,rt);i(this,"value");i(this,"unit");this.value=t,this.unit="px/s"}create(t){return new R(t)}};let m=R;rt=K;const X=Symbol();var nt;const y=class extends v{constructor(t){super();i(this,nt);i(this,"value");i(this,"unit");this.value=t,this.unit="s"}create(t){return new y(t)}};let A=y;nt=X;const Z=Symbol();var ot;const I=class extends v{constructor(t){super();i(this,ot);i(this,"value");i(this,"unit");this.value=t,this.unit="px/s\xB2"}create(t){return new I(t)}};let G=I;ot=Z;const J=new A(1.5),p={WIDTH:window.innerWidth,HEIGHT:window.innerHeight},w={GRAVITY:new G(p.HEIGHT*2/J.value**2),PIPE_WIDTH:80,GAP:140,GAP_BETWEEN_TWO_PIPE:p.HEIGHT/2.5},a={SPEED_H:new m(120),SPEED_V:new m(0),SPEED_FLAP:new m(w.GRAVITY.value/2.5),LEFT:50,TOP:p.HEIGHT/2,WIDTH:30,HEIGHT:30,COLOR:"#ff0000"};class L extends H{constructor(t,e){super({top:a.TOP,left:a.LEFT,width:a.WIDTH,height:a.HEIGHT,color:a.COLOR});i(this,"speedVertical");i(this,"speedHorizontal");this.speedVertical=t,this.speedHorizontal=e}flap(){this.speedVertical.value>=0?this.speedVertical=this.speedVertical.add(a.SPEED_FLAP):this.speedVertical=a.SPEED_FLAP}drop(t,e){this.speedVertical=this.speedVertical.substract(new m(t.value*e.value))}fly(t,e){this.top+=-this.speedVertical.value*e.value,t.moveOn(this.speedHorizontal,e)}}class S extends d{constructor(t){super(D(B({},t),{width:0,height:0}));i(this,"text");i(this,"font");i(this,"textAlign");i(this,"textBaseLine");this.text=t.text,this.font=t.font,this.textAlign=t.textAlign||"center",this.textBaseLine=t.textBaseLine||"middle"}render(t){t.fillStyle=this.color,t.textAlign=this.textAlign,t.font=this.font,t.textBaseline=this.textBaseLine,t.fillText(this.text,this.left,this.top)}}var P;(function(r){r.GAME_NAME="\u6572\u597D\u73A9\u7684 Flappy Bird! \u{1F425}",r.GAME_OVER="Never mind, \u518D\u51B2\u4E00\u6B21!"})(P||(P={}));var E;(function(r){r.START="\u5F00\u59CB",r.RESTART="\u51B2\u51B2\u51B2!\u{1F431}\u200D\u{1F3CD}"})(E||(E={}));class M extends d{constructor(t,e){super({width:t,height:e,top:0,left:0,color:"#cbcbcbcc"});i(this,"_onStart");i(this,"_onRestart");i(this,"_button");i(this,"_buttonText");i(this,"_gameTitle");i(this,"_scoreText");i(this,"visible");this.visible=!1;const n=Math.max(t/10,200),s=n/3,o={top:e/2+s,left:t/2-n/2,width:n,height:s,color:"#ffa500"};this._button=new d(o);const h=s/2;this._buttonText=new S({left:o.left+n/2,top:o.top+s/2,color:"#fff",text:E.START,font:`${h}px Microsoft Yahei`,textAlign:"center",textBaseLine:"middle"});const c=s;this._gameTitle=new S({left:o.left+n/2,top:o.top-s*2,color:"#ff0000",text:P.GAME_NAME,font:`${c}px Microsoft Yahei`,textAlign:"center",textBaseLine:"bottom"}),this._scoreText=new S({left:this._gameTitle.left,top:this._gameTitle.top+h,color:"#fff",text:"",font:`${h}px Microsoft Yahei`,textBaseLine:"top"})}onStart(t){this._onStart=t}onRestart(t){this._onRestart=t}boot(){console.log("welcome playing flappy bird! enjoy it!"),this.show()}show(){this.visible=!0}hide(){this.visible=!1}showPause(){this.show(),this._gameTitle.text=P.GAME_NAME,this._buttonText.text=E.START}showGameover(t){this.show(),this._scoreText.text=`\u5F97\u5206 ${t}\u5206 `,this._gameTitle.text=P.GAME_OVER,this._buttonText.text=E.RESTART}click(t,e){const n=new d({top:t.offsetY,left:t.offsetX,width:0,height:0});if(this._button.isOverlay(n))switch(e){case l.GAME_OVER:this._onRestart&&this._onRestart();break;case l.READY:this._onStart&&this._onStart();break;case l.PAUSED:this._onStart&&this._onStart();break}}render(t){!this.visible||(super.render(t),this._button.render(t),this._buttonText.render(t),this._gameTitle.render(t),this._scoreText.text&&(this._scoreText.render(t),this._scoreText.text=""))}}class F extends H{constructor(t,e,n,s){super({top:t,left:e,height:s,width:n,color:"#008000"})}}class Q{static create(t,e,n,s){const o=Math.round(Math.random()*(n-s)),h=o+s,c=n-o-s,u=new F(0,t,e,o),f=new F(h,t,e,c);return[u,f]}}class W extends d{constructor(t,e){const n={width:t,height:e,top:0,left:0,color:"#e3e3e3"};super(n);i(this,"pipePairs");i(this,"pipeWidth");i(this,"gap");i(this,"gapBetweenPipes");i(this,"grvaity");i(this,"totalDistance");this.pipePairs=[],this.pipeWidth=w.PIPE_WIDTH,this.gap=w.GAP,this.gapBetweenPipes=w.GAP_BETWEEN_TWO_PIPE,this.grvaity=w.GRAVITY,this.totalDistance=0,this.fillPipePairs(p.WIDTH/3)}moveOn(t,e){const n=t.value*e.value;this.totalDistance+=n,this.pipePairs.forEach(([s,o])=>{s.left-=n,o.left-=n})}changeStyle(t){Object.assign(this,t)}render(t){this.fillPipePairs(),super.render(t),this.pipePairs.forEach(e=>{e.forEach(n=>n.render(t))})}isCollided(t){return this.isCollidedAnyPipe(t)||this.isCollidedMapBoundary(t)}isCollidedMapBoundary(t){return!this.isContain(t)}isCollidedAnyPipe(t){return this.pipePairs.some(e=>e.some(n=>n.isCollidedWith(t)))}fillPipePairs(t=0){const e=this.width-t,n=this.height,s=this.pipeWidth,o=this.gap,h=this.gapBetweenPipes,c=this.pipePairs.length;let u=c,f=c;for(let g=0;g<c;g++){const[T]=this.pipePairs[g];if(T.left+T.width>=0){u=g;break}}const[b]=u<f?this.pipePairs[f-1]:[],x=b?b.left+b.width:0,V=e-x>0?e-x:0,C=Math.ceil(V/(s+o)),N=this.pipePairs.slice(u,f),Y=new Array(C).fill(0).map((g,T)=>Q.create(x+(o+s)*(T+1)-s+t,s,n,h));this.pipePairs=N.concat(Y)}}class tt{constructor(t){i(this,"animId");i(this,"lastTimeRender");i(this,"renderFn");this.renderFn=t}run(){const t=e=>{const n=this.lastTimeRender?e-this.lastTimeRender:0,s=new A(n/1e3);this.lastTimeRender=e,this.renderFn(s),this.animId=window.requestAnimationFrame(t)};this.animId=window.requestAnimationFrame(t)}stop(){this.animId&&(window.cancelAnimationFrame(this.animId),this.animId=void 0,this.lastTimeRender=void 0)}}var l;(function(r){r.READY="ready",r.PLAYING="playing",r.PAUSED="paused",r.GAME_OVER="gameOver"})(l||(l={}));class et{constructor(t){i(this,"bird");i(this,"map");i(this,"bootScreen");i(this,"score");i(this,"ctx");i(this,"anim");i(this,"canvasEle");i(this,"status");this.canvasEle=t;const e=t.getContext("2d");if(!e)throw new Error("can not get canvas context 2d");this.ctx=e,this.bird=new L(a.SPEED_V,a.SPEED_H),this.map=new W(t.width,t.height),this.anim=new tt(this.playing.bind(this)),this.bootScreen=new M(t.width,t.height),this.score=0,this.status=l.READY,this.registerListener(),this.bootScreen.boot(),this.render()}start(){console.log("start"),this.status=l.PLAYING,this.bootScreen.hide(),this.anim.run()}restart(){console.log("restart"),this.resetGame(),this.start()}playing(t){if(this.status!==l.GAME_OVER&&(this.bird.drop(this.map.grvaity,t),this.bird.fly(this.map,t),this.render(),this.map.isCollided(this.bird)))return this.gameOver()}pause(){console.log("pause"),this.status=l.PAUSED,this.bootScreen.showPause(),this.anim.stop()}gameOver(){this.pause(),this.status=l.GAME_OVER,this.score=Math.round(this.map.totalDistance),this.bootScreen.showGameover(this.score),this.render(),console.log("gameOver, your score:",this.score)}birdFlap(){this.bird.flap()}resetGame(){const t=this.canvasEle;this.bird=new L(a.SPEED_V,a.SPEED_H),this.map=new W(t.width,t.height),this.bootScreen=new M(t.width,t.height),this.score=0,this.registerListener()}render(){this.map.render(this.ctx),this.bird.render(this.ctx),this.bootScreen.render(this.ctx)}registerListener(){this.bootScreen.onStart(this.start.bind(this)),this.bootScreen.onRestart(this.restart.bind(this)),this.canvasEle.onclick=t=>{this.status===l.PLAYING?this.birdFlap():this.bootScreen.click(t,this.status)}}}window.onload=()=>{const r=document.querySelector("#gameWindow");r.width=p.WIDTH,r.height=p.HEIGHT,new et(r)};
